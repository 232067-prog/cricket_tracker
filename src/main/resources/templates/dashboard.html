<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Tracker - Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-email {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-right: 1rem;
        }

        .btn-logout {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: translateY(-2px);
        }

        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            .user-profile {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="/" class="navbar-brand">
                <span class="icon">üèè</span>
                Cricket Tracker
            </a>
            <button class="menu-toggle">‚ò∞</button>
            <ul class="navbar-menu">
                <li><a href="/">Dashboard</a></li>
                <li><a href="/matches/add">Add Match</a></li>
                <li><a href="/matches/history">History</a></li>
                <li><a href="/matches/statistics">Statistics</a></li>
                <li class="user-profile" id="userProfile" style="display: none;">
                    <span class="user-email" id="userEmail"></span>
                    <button class="btn-logout" id="logoutBtn">Logout</button>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">üèè Cricket Performance Tracker</h1>
                <p class="page-subtitle">Track your cricket journey, one match at a time</p>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="loading-container">
                <div class="spinner"></div>
            </div>

            <!-- Main Content (Hidden until loaded) -->
            <div id="mainContent" style="display: none;">
                <!-- Statistics Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-label">Total Matches</div>
                        <div class="stat-value" id="totalMatches">0</div>
                    </div>

                    <div class="stat-card success">
                        <div class="stat-icon">üèÉ</div>
                        <div class="stat-label">Total Runs</div>
                        <div class="stat-value" id="totalRuns">0</div>
                    </div>

                    <div class="stat-card warning">
                        <div class="stat-icon">üé≥</div>
                        <div class="stat-label">Total Wickets</div>
                        <div class="stat-value" id="totalWickets">0</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-label">Batting Average</div>
                        <div class="stat-value" id="battingAverage">0.00</div>
                    </div>

                    <div class="stat-card success">
                        <div class="stat-icon">‚ö°</div>
                        <div class="stat-label">Strike Rate</div>
                        <div class="stat-value" id="strikeRate">0.00</div>
                    </div>

                    <div class="stat-card warning">
                        <div class="stat-icon">üéñÔ∏è</div>
                        <div class="stat-label">Highest Score</div>
                        <div class="stat-value" id="highestScore">0</div>
                    </div>
                </div>

                <!-- Recent Matches -->
                <div class="card" id="recentMatchesCard" style="display: none;">
                    <div class="card-header">
                        <h2 class="card-title">üìã Recent Matches</h2>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Opponent</th>
                                    <th>Runs</th>
                                    <th>Wickets</th>
                                    <th>Strike Rate</th>
                                </tr>
                            </thead>
                            <tbody id="recentMatchesBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Empty State -->
                <div class="card" id="emptyState" style="display: none;">
                    <div class="empty-state">
                        <div class="empty-state-icon">üèè</div>
                        <div class="empty-state-text">No matches recorded yet</div>
                        <p>Start tracking your cricket performance by adding your first match!</p>
                        <a href="/matches/add" class="btn btn-primary">Add Your First Match</a>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="btn-group" style="margin-top: 2rem;">
                    <a href="/matches/add" class="btn btn-primary">‚ûï Add New Match</a>
                    <a href="/matches/history" class="btn btn-secondary">üìú View All Matches</a>
                    <a href="/matches/statistics" class="btn btn-success">üìä Detailed Statistics</a>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2024 Cricket Tracker. Built for local cricket players. üèè</p>
        </div>
    </footer>

    <script src="/js/script.js"></script>
    <script type="module">
        import { requireAuth, signOut, calculatePlayerStatistics, getRecentMatches } from '/js/firestore-service.js';

        // Initialize dashboard
        async function initializeDashboard() {
            try {
                // Check authentication
                const user = await requireAuth();

                // Update user profile in nav
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('userProfile').style.display = 'flex';

                // Load data
                await loadDashboardData();

                // Hide loading, show content
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            } catch (error) {
                console.error('Dashboard initialization error:', error);
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Get statistics
                const stats = await calculatePlayerStatistics();

                // Update statistics
                document.getElementById('totalMatches').textContent = stats.totalMatches;
                document.getElementById('totalRuns').textContent = stats.totalRuns;
                document.getElementById('totalWickets').textContent = stats.totalWickets;
                document.getElementById('battingAverage').textContent = stats.overallBattingAverage;
                document.getElementById('strikeRate').textContent = stats.overallStrikeRate;
                document.getElementById('highestScore').textContent = stats.highestScore;

                // Get recent matches
                const recentMatches = await getRecentMatches(5);

                if (recentMatches.length > 0) {
                    displayRecentMatches(recentMatches);
                    document.getElementById('recentMatchesCard').style.display = 'block';
                    document.getElementById('emptyState').style.display = 'none';
                } else {
                    document.getElementById('recentMatchesCard').style.display = 'none';
                    document.getElementById('emptyState').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Display recent matches
        function displayRecentMatches(matches) {
            const tbody = document.getElementById('recentMatchesBody');
            tbody.innerHTML = '';

            matches.forEach(match => {
                const row = document.createElement('tr');

                // Format date
                const date = new Date(match.matchDate);
                const formattedDate = date.toLocaleDateString('en-US', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });

                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${match.opponentName}</td>
                    <td>${match.runsScored}</td>
                    <td>${match.wicketsTaken}</td>
                    <td>${match.strikeRate}</td>
                `;

                tbody.appendChild(row);
            });
        }

        // Handle logout
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                await signOut();
            } catch (error) {
                console.error('Logout error:', error);
            }
        });

        // Initialize on page load
        initializeDashboard();
    </script>
</body>

</html>